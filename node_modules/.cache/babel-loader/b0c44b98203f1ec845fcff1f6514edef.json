{"ast":null,"code":"'use strict';\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from) {\n  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) {\n    to[j] = from[i];\n  }\n\n  return to;\n};\n\nvar constants = require('./constants');\n\nvar E = constants.typeErrors,\n    trackPriority = constants.trackPriority;\n\nvar util = require('../webrtc/util');\n\nvar sessionSID = require('./sid').sessionSID;\n\nvar TwilioWarning = require('./twiliowarning');\n/**\n * Return the given {@link LocalTrack} or a new {@link LocalTrack} for the\n * given MediaStreamTrack.\n * @param {LocalTrack|MediaStreamTrack} track\n * @param {object} options\n * @returns {LocalTrack}\n * @throws {TypeError}\n */\n\n\nfunction asLocalTrack(track, options) {\n  if (track instanceof options.LocalAudioTrack || track instanceof options.LocalVideoTrack || track instanceof options.LocalDataTrack) {\n    return track;\n  }\n\n  if (track instanceof options.MediaStreamTrack) {\n    return track.kind === 'audio' ? new options.LocalAudioTrack(track, options) : new options.LocalVideoTrack(track, options);\n  }\n  /* eslint new-cap:0 */\n\n\n  throw E.INVALID_TYPE('track', 'LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack');\n}\n/**\n * Create a new {@link LocalTrackPublication} for the given {@link LocalTrack}.\n * @param {LocalTrack} track\n * @param {LocalTrackPublicationSignaling} signaling\n * @param {function(track: LocalTrackPublication): void} unpublish\n * @param {object} options\n */\n\n\nfunction asLocalTrackPublication(track, signaling, unpublish, options) {\n  var LocalTrackPublication = {\n    audio: options.LocalAudioTrackPublication,\n    video: options.LocalVideoTrackPublication,\n    data: options.LocalDataTrackPublication\n  }[track.kind];\n  return new LocalTrackPublication(signaling, track, unpublish, options);\n}\n/**\n * Capitalize a word.\n * @param {string} word\n * @returns {string} capitalized\n */\n\n\nfunction capitalize(word) {\n  return word[0].toUpperCase() + word.slice(1);\n}\n/**\n * Log deprecation warnings for the given events of an EventEmitter.\n * @param {string} name\n * @param {EventEmitter} emitter\n * @param {Map<string, string>} events\n * @param {Log} log\n */\n\n\nfunction deprecateEvents(name, emitter, events, log) {\n  var warningsShown = new Set();\n  emitter.on('newListener', function newListener(event) {\n    if (events.has(event) && !warningsShown.has(event)) {\n      log.deprecated(name + \"#\" + event + \" has been deprecated and scheduled for removal in twilio-video.js@2.0.0.\" + (events.get(event) ? \" Use \" + name + \"#\" + events.get(event) + \" instead.\" : ''));\n      warningsShown.add(event);\n    }\n\n    if (warningsShown.size >= events.size) {\n      emitter.removeListener('newListener', newListener);\n    }\n  });\n}\n/**\n * Finds the items in list1 that are not in list2.\n * @param {Array<*>|Map<*>|Set<*>} list1\n * @param {Array<*>|Map<*>|Set<*>} list2\n * @returns {Set}\n */\n\n\nfunction difference(list1, list2) {\n  list1 = Array.isArray(list1) ? new Set(list1) : new Set(list1.values());\n  list2 = Array.isArray(list2) ? new Set(list2) : new Set(list2.values());\n  var difference = new Set();\n  list1.forEach(function (item) {\n    if (!list2.has(item)) {\n      difference.add(item);\n    }\n  });\n  return difference;\n}\n/**\n * Filter out the keys in an object with a given value.\n * @param {object} object - Object to be filtered\n * @param {*} [filterValue] - Value to be filtered out; If not specified, then\n *   filters out all keys which have an explicit value of \"undefined\"\n * @returns {object} - Filtered object\n */\n\n\nfunction filterObject(object, filterValue) {\n  return Object.keys(object).reduce(function (filtered, key) {\n    if (object[key] !== filterValue) {\n      filtered[key] = object[key];\n    }\n\n    return filtered;\n  }, {});\n}\n/**\n * Map a list to an array of arrays, and return the flattened result.\n * @param {Array<*>|Set<*>|Map<*>} list\n * @param {function(*): Array<*>} [mapFn]\n * @returns Array<*>\n */\n\n\nfunction flatMap(list, mapFn) {\n  var listArray = list instanceof Map || list instanceof Set ? Array.from(list.values()) : list;\n\n  mapFn = mapFn || function mapFn(item) {\n    return item;\n  };\n\n  return listArray.reduce(function (flattened, item) {\n    var mapped = mapFn(item);\n    return flattened.concat(mapped);\n  }, []);\n}\n/**\n * Get the user agent string, or return \"Unknown\".\n * @returns {string}\n */\n\n\nfunction getUserAgent() {\n  return typeof navigator !== 'undefined' && navigator.userAgent ? navigator.userAgent : 'Unknown';\n}\n/**\n * Get the platform component of the user agent string.\n * Example:\n *   Input - Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.82 Safari/537.36\n *   Output - macintosh\n * @returns {string}\n */\n\n\nfunction getPlatform() {\n  var userAgent = getUserAgent();\n\n  var _a = __read(userAgent.match(/\\(([^)]+)\\)/) || [], 2),\n      _b = _a[1],\n      match = _b === void 0 ? 'unknown' : _b;\n\n  var _c = __read(match.split(';').map(function (entry) {\n    return entry.trim();\n  }), 1),\n      platform = _c[0];\n\n  return platform.toLowerCase();\n}\n/**\n * Create a unique identifier.\n * @returns {string}\n */\n\n\nfunction makeUUID() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = Math.random() * 16 | 0;\n    var v = c === 'x' ? r : r & 0x3 | 0x8;\n    return v.toString(16);\n  });\n}\n/**\n * Ensure that the given function is called once per tick.\n * @param {function} fn - Function to be executed\n * @returns {function} - Schedules the given function to be called on the next tick\n */\n\n\nfunction oncePerTick(fn) {\n  var timeout = null;\n\n  function nextTick() {\n    timeout = null;\n    fn();\n  }\n\n  return function scheduleNextTick() {\n    if (timeout) {\n      clearTimeout(timeout);\n    }\n\n    timeout = setTimeout(nextTick);\n  };\n}\n\nfunction promiseFromEvents(operation, eventEmitter, successEvent, failureEvent) {\n  return new Promise(function (resolve, reject) {\n    function onSuccess() {\n      var args = [].slice.call(arguments);\n\n      if (failureEvent) {\n        eventEmitter.removeListener(failureEvent, onFailure);\n      }\n\n      resolve.apply(void 0, __spreadArray([], __read(args)));\n    }\n\n    function onFailure() {\n      var args = [].slice.call(arguments);\n      eventEmitter.removeListener(successEvent, onSuccess);\n      reject.apply(void 0, __spreadArray([], __read(args)));\n    }\n\n    eventEmitter.once(successEvent, onSuccess);\n\n    if (failureEvent) {\n      eventEmitter.once(failureEvent, onFailure);\n    }\n\n    operation();\n  });\n}\n/**\n * Traverse down multiple nodes on an object and return null if\n * any link in the path is unavailable.\n * @param {Object} obj - Object to traverse\n * @param {String} path - Path to traverse. Period-separated.\n * @returns {Any|null}\n */\n\n\nfunction getOrNull(obj, path) {\n  return path.split('.').reduce(function (output, step) {\n    if (!output) {\n      return null;\n    }\n\n    return output[step];\n  }, obj);\n}\n/**\n * @typedef {object} Deferred\n * @property {Promise} promise\n * @property {function} reject\n * @property {function} resolve\n */\n\n/**\n * Create a {@link Deferred}.\n * @returns {Deferred}\n */\n\n\nfunction defer() {\n  var deferred = {};\n  deferred.promise = new Promise(function (resolve, reject) {\n    deferred.resolve = resolve;\n    deferred.reject = reject;\n  });\n  return deferred;\n}\n/**\n * Copy a method from a `source` prototype onto a `wrapper` prototype. Invoking\n * the method on the `wrapper` prototype will invoke the corresponding method\n * on an instance accessed by `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @param {string} methodName\n * @returns {undefined}\n */\n\n\nfunction delegateMethod(source, wrapper, target, methodName) {\n  if (methodName in wrapper) {\n    // Skip any methods already set.\n    return;\n  } else if (methodName.match(/^on[a-z]+$/)) {\n    // Skip EventHandlers (these are handled in the constructor).\n    return;\n  }\n\n  var type;\n\n  try {\n    type = typeof source[methodName];\n  } catch (error) {// NOTE(mroberts): Attempting to check the type of non-function members\n    // on the prototype throws an error for some types.\n  }\n\n  if (type !== 'function') {\n    // Skip non-function members.\n    return;\n  }\n  /* eslint no-loop-func:0 */\n\n\n  wrapper[methodName] = function () {\n    var _a;\n\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return (_a = this[target])[methodName].apply(_a, __spreadArray([], __read(args)));\n  };\n}\n/**\n * Copy methods from a `source` prototype onto a `wrapper` prototype. Invoking\n * the methods on the `wrapper` prototype will invoke the corresponding method\n * on an instance accessed by `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @returns {undefined}\n */\n\n\nfunction delegateMethods(source, wrapper, target) {\n  for (var methodName in source) {\n    delegateMethod(source, wrapper, target, methodName);\n  }\n}\n/**\n * Determine whether two values are deeply equal.\n * @param {*} val1\n * @param {*} val2\n * @returns {boolean}\n */\n\n\nfunction isDeepEqual(val1, val2) {\n  if (val1 === val2) {\n    return true;\n  }\n\n  if (typeof val1 !== typeof val2) {\n    return false;\n  }\n\n  if (val1 === null) {\n    return val2 === null;\n  }\n\n  if (val2 === null) {\n    return false;\n  }\n\n  if (Array.isArray(val1)) {\n    return Array.isArray(val2) && val1.length === val2.length && val1.every(function (val, i) {\n      return isDeepEqual(val, val2[i]);\n    });\n  }\n\n  if (typeof val1 === 'object') {\n    var val1Keys = Object.keys(val1).sort();\n    var val2Keys = Object.keys(val2).sort();\n    return !Array.isArray(val2) && isDeepEqual(val1Keys, val2Keys) && val1Keys.every(function (key) {\n      return isDeepEqual(val1[key], val2[key]);\n    });\n  }\n\n  return false;\n}\n/**\n * Whether the given argument is a non-array object.\n * @param {*} object\n * @return {boolean}\n */\n\n\nfunction isNonArrayObject(object) {\n  return typeof object === 'object' && !Array.isArray(object);\n}\n/**\n * For each property name on the `source` prototype, add getters and/or setters\n * to `wrapper` that proxy to `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @returns {undefined}\n */\n\n\nfunction proxyProperties(source, wrapper, target) {\n  Object.getOwnPropertyNames(source).forEach(function (propertyName) {\n    proxyProperty(source, wrapper, target, propertyName);\n  });\n}\n/**\n * For the property name on the `source` prototype, add a getter and/or setter\n * to `wrapper` that proxies to `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @param {string} propertyName\n * @returns {undefined}\n */\n\n\nfunction proxyProperty(source, wrapper, target, propertyName) {\n  if (propertyName in wrapper) {\n    // Skip any properties already set.\n    return;\n  } else if (propertyName.match(/^on[a-z]+$/)) {\n    Object.defineProperty(wrapper, propertyName, {\n      value: null,\n      writable: true\n    });\n    target.addEventListener(propertyName.slice(2), function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      wrapper.dispatchEvent.apply(wrapper, __spreadArray([], __read(args)));\n    });\n    return;\n  }\n\n  Object.defineProperty(wrapper, propertyName, {\n    enumerable: true,\n    get: function get() {\n      return target[propertyName];\n    }\n  });\n}\n/**\n * This is a function for turning a Promise into the kind referenced in the\n * Legacy Interface Extensions section of the WebRTC spec.\n * @param {Promise<*>} promise\n * @param {function<*>} onSuccess\n * @param {function<Error>} onFailure\n * @returns {Promise<undefined>}\n */\n\n\nfunction legacyPromise(promise, onSuccess, onFailure) {\n  if (onSuccess) {\n    return promise.then(function (result) {\n      onSuccess(result);\n    }, function (error) {\n      onFailure(error);\n    });\n  }\n\n  return promise;\n}\n/**\n * Build the {@link LogLevels} object.\n * @param {String|LogLevel} logLevel - Log level name or object\n * @returns {LogLevels}\n */\n\n\nfunction buildLogLevels(logLevel) {\n  if (typeof logLevel === 'string') {\n    return {\n      default: logLevel,\n      media: logLevel,\n      signaling: logLevel,\n      webrtc: logLevel\n    };\n  }\n\n  return logLevel;\n}\n/**\n * Get the {@link Track}'s derived class name\n * @param {Track} track\n * @param {?boolean} [local=undefined]\n * @returns {string}\n */\n\n\nfunction trackClass(track, local) {\n  local = local ? 'Local' : '';\n  return local + (track.kind || '').replace(/\\w{1}/, function (m) {\n    return m.toUpperCase();\n  }) + \"Track\";\n}\n/**\n * Get the {@link TrackPublication}'s derived class name\n * @param {TrackPublication} publication\n * @param {?boolean} [local=undefined]\n * @returns {string}\n */\n\n\nfunction trackPublicationClass(publication, local) {\n  local = local ? 'Local' : '';\n  return local + (publication.kind || '').replace(/\\w{1}/, function (m) {\n    return m.toUpperCase();\n  }) + \"TrackPublication\";\n}\n/**\n * Sets all underscore-prefixed properties on `object` non-enumerable.\n * @param {Object} object\n * @returns {void}\n */\n\n\nfunction hidePrivateProperties(object) {\n  Object.getOwnPropertyNames(object).forEach(function (name) {\n    if (name.startsWith('_')) {\n      hideProperty(object, name);\n    }\n  });\n}\n/**\n * Creates a new subclass which, in the constructor, sets all underscore-prefixed\n * properties and the given public properties non-enumerable. This is useful for\n * patching up classes like EventEmitter which may set properties like `_events`\n * and `domain`.\n * @param {Function} klass\n * @param {Array<string>} props\n * @returns {Function} subclass\n */\n\n\nfunction hidePrivateAndCertainPublicPropertiesInClass(klass, props) {\n  // NOTE(mroberts): We do this to avoid giving the class a name.\n  return (\n    /** @class */\n    function (_super) {\n      __extends(class_1, _super);\n\n      function class_1() {\n        var args = [];\n\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n\n        var _this = _super.apply(this, __spreadArray([], __read(args))) || this;\n\n        hidePrivateProperties(_this);\n        hidePublicProperties(_this, props);\n        return _this;\n      }\n\n      return class_1;\n    }(klass)\n  );\n}\n/**\n * Hide a property of an object.\n * @param {object} object\n * @param {string} name\n */\n\n\nfunction hideProperty(object, name) {\n  var descriptor = Object.getOwnPropertyDescriptor(object, name);\n  descriptor.enumerable = false;\n  Object.defineProperty(object, name, descriptor);\n}\n/**\n * Hide the given public properties of an object.\n * @param {object} object\n * @param {Array<string>} [props=[]]\n */\n\n\nfunction hidePublicProperties(object, props) {\n  if (props === void 0) {\n    props = [];\n  }\n\n  props.forEach(function (name) {\n    // eslint-disable-next-line no-prototype-builtins\n    if (object.hasOwnProperty(name)) {\n      hideProperty(object, name);\n    }\n  });\n}\n/**\n * Convert an Array of values to an Array of JSON values by calling\n * `valueToJSON` on each value.\n * @param {Array<*>} array\n * @returns {Array<*>}\n */\n\n\nfunction arrayToJSON(array) {\n  return array.map(valueToJSON);\n}\n/**\n * Convert a Set of values to an Array of JSON values by calling `valueToJSON`\n * on each value.\n * @param {Set<*>} set\n * @returns {Array<*>}\n */\n\n\nfunction setToJSON(set) {\n  return arrayToJSON(__spreadArray([], __read(set)));\n}\n/**\n * Convert a Map from strings to values to an object of JSON values by calling\n * `valueToJSON` on each value.\n * @param {Map<string, *>} map\n * @returns {object}\n */\n\n\nfunction mapToJSON(map) {\n  return __spreadArray([], __read(map.entries())).reduce(function (json, _a) {\n    var _b;\n\n    var _c = __read(_a, 2),\n        key = _c[0],\n        value = _c[1];\n\n    return Object.assign((_b = {}, _b[key] = valueToJSON(value), _b), json);\n  }, {});\n}\n/**\n * Convert an object to a JSON value by calling `valueToJSON` on its enumerable\n * keys.\n * @param {object} object\n * @returns {object}\n */\n\n\nfunction objectToJSON(object) {\n  return Object.entries(object).reduce(function (json, _a) {\n    var _b;\n\n    var _c = __read(_a, 2),\n        key = _c[0],\n        value = _c[1];\n\n    return Object.assign((_b = {}, _b[key] = valueToJSON(value), _b), json);\n  }, {});\n}\n/**\n * Convert a value into a JSON value.\n * @param {*} value\n * @returns {*}\n */\n\n\nfunction valueToJSON(value) {\n  if (Array.isArray(value)) {\n    return arrayToJSON(value);\n  } else if (value instanceof Set) {\n    return setToJSON(value);\n  } else if (value instanceof Map) {\n    return mapToJSON(value);\n  } else if (value && typeof value === 'object') {\n    return objectToJSON(value);\n  }\n\n  return value;\n}\n\nfunction createRoomConnectEventPayload(connectOptions) {\n  function boolToString(val) {\n    return val ? 'true' : 'false';\n  }\n\n  var payload = {\n    sessionSID: sessionSID,\n    // arrays props converted to lengths.\n    iceServers: (connectOptions.iceServers || []).length,\n    audioTracks: (connectOptions.tracks || []).filter(function (track) {\n      return track.kind === 'audio';\n    }).length,\n    videoTracks: (connectOptions.tracks || []).filter(function (track) {\n      return track.kind === 'video';\n    }).length,\n    dataTracks: (connectOptions.tracks || []).filter(function (track) {\n      return track.kind === 'data';\n    }).length\n  }; // boolean properties.\n\n  [['audio'], ['automaticSubscription'], ['enableDscp'], ['eventListener'], ['preflight'], ['video'], ['dominantSpeaker', 'enableDominantSpeaker']].forEach(function (_a) {\n    var _b = __read(_a, 2),\n        prop = _b[0],\n        eventProp = _b[1];\n\n    eventProp = eventProp || prop;\n    payload[eventProp] = boolToString(!!connectOptions[prop]);\n  }); // numbers properties.\n\n  [['maxVideoBitrate'], ['maxAudioBitrate']].forEach(function (_a) {\n    var _b = __read(_a, 2),\n        prop = _b[0],\n        eventProp = _b[1];\n\n    eventProp = eventProp || prop;\n\n    if (typeof connectOptions[prop] === 'number') {\n      payload[eventProp] = connectOptions[prop];\n    } else if (!isNaN(Number(connectOptions[prop]))) {\n      payload[eventProp] = Number(connectOptions[prop]);\n    }\n  }); // string properties.\n\n  [['iceTransportPolicy'], ['region'], ['name', 'roomName']].forEach(function (_a) {\n    var _b = __read(_a, 2),\n        prop = _b[0],\n        eventProp = _b[1];\n\n    eventProp = eventProp || prop;\n\n    if (typeof connectOptions[prop] === 'string') {\n      payload[eventProp] = connectOptions[prop];\n    } else if (typeof connectOptions[prop] === 'number' && prop === 'name') {\n      payload[eventProp] = connectOptions[prop].toString();\n    }\n  }); // array props stringified.\n\n  ['preferredAudioCodecs', 'preferredVideoCodecs'].forEach(function (prop) {\n    if (prop in connectOptions) {\n      payload[prop] = JSON.stringify(connectOptions[prop]);\n    }\n  });\n\n  if ('networkQuality' in connectOptions) {\n    payload.networkQualityConfiguration = {};\n\n    if (isNonArrayObject(connectOptions.networkQuality)) {\n      ['local', 'remote'].forEach(function (prop) {\n        if (typeof connectOptions.networkQuality[prop] === 'number') {\n          payload.networkQualityConfiguration[prop] = connectOptions.networkQuality[prop];\n        }\n      });\n    } else {\n      payload.networkQualityConfiguration.remote = 0;\n      payload.networkQualityConfiguration.local = connectOptions.networkQuality ? 1 : 0;\n    }\n  }\n\n  if (connectOptions.bandwidthProfile && connectOptions.bandwidthProfile.video) {\n    var videoBPOptions_1 = connectOptions.bandwidthProfile.video || {};\n    payload.bandwidthProfileOptions = {};\n    ['mode', 'maxTracks', 'trackSwitchOffMode', 'dominantSpeakerPriority', 'maxSubscriptionBitrate', 'renderDimensions', 'contentPreferencesMode', 'clientTrackSwitchOffControl'].forEach(function (prop) {\n      if (typeof videoBPOptions_1[prop] === 'number' || typeof videoBPOptions_1[prop] === 'string') {\n        payload.bandwidthProfileOptions[prop] = videoBPOptions_1[prop];\n      } else if (typeof videoBPOptions_1[prop] === 'boolean') {\n        payload.bandwidthProfileOptions[prop] = boolToString(videoBPOptions_1[prop]);\n      } else if (typeof videoBPOptions_1[prop] === 'object') {\n        payload.bandwidthProfileOptions[prop] = JSON.stringify(videoBPOptions_1[prop]);\n      }\n    });\n  }\n\n  return {\n    group: 'room',\n    name: 'connect',\n    level: 'info',\n    payload: payload\n  };\n}\n/**\n * Create the bandwidth profile payload included in an RSP connect message.\n * @param {BandwidthProfileOptions} bandwidthProfile\n * @returns {object}\n */\n\n\nfunction createBandwidthProfilePayload(bandwidthProfile) {\n  return createRSPPayload(bandwidthProfile, [{\n    prop: 'video',\n    type: 'object',\n    transform: createBandwidthProfileVideoPayload\n  }]);\n}\n/**\n * Create the bandwidth profile video payload included in an RSP connect message.\n * @param {VideoBandwidthProfileOptions} bandwidthProfileVideo\n * @returns {object}\n */\n\n\nfunction createBandwidthProfileVideoPayload(bandwidthProfileVideo) {\n  return createRSPPayload(bandwidthProfileVideo, [{\n    prop: 'dominantSpeakerPriority',\n    type: 'string',\n    payloadProp: 'active_speaker_priority'\n  }, {\n    prop: 'maxSubscriptionBitrate',\n    type: 'number',\n    payloadProp: 'max_subscription_bandwidth'\n  }, {\n    prop: 'maxTracks',\n    type: 'number',\n    payloadProp: 'max_tracks'\n  }, {\n    prop: 'mode',\n    type: 'string'\n  }, {\n    prop: 'renderDimensions',\n    type: 'object',\n    payloadProp: 'render_dimensions',\n    transform: createRenderDimensionsPayload\n  }, {\n    prop: 'trackSwitchOffMode',\n    type: 'string',\n    payloadProp: 'track_switch_off'\n  }]);\n}\n/**\n * Create the Media Signaling payload included in an RSP connect message.\n * @param {boolean} dominantSpeaker - whether to enable the Dominant Speaker\n *   protocol or not\n * @param {boolean} networkQuality - whether to enable the Network Quality\n *   protocol or not\n * @param {boolean} trackPriority - whether to enable the Track Priority\n *   protocol or not\n * @param {boolean} trackSwitchOff - whether to enable the Track Switch-Off\n *   protocol or not.\n * @param {boolean} renderHints - whether to enable the renderHints\n *   protocol or not.\n * @returns {object}\n */\n\n\nfunction createMediaSignalingPayload(dominantSpeaker, networkQuality, trackPriority, trackSwitchOff, adaptiveSimulcast, renderHints) {\n  var transports = {\n    transports: [{\n      type: 'data-channel'\n    }]\n  };\n  return Object.assign(dominantSpeaker // eslint-disable-next-line\n  ? {\n    active_speaker: transports\n  } : {}, networkQuality // eslint-disable-next-line\n  ? {\n    network_quality: transports\n  } : {}, renderHints // eslint-disable-next-line\n  ? {\n    render_hints: transports\n  } : {}, adaptiveSimulcast // eslint-disable-next-line\n  ? {\n    publisher_hints: transports\n  } : {}, trackPriority // eslint-disable-next-line\n  ? {\n    track_priority: transports\n  } : {}, trackSwitchOff // eslint-disable-next-line\n  ? {\n    track_switch_off: transports\n  } : {});\n}\n/**\n * Create {@link VideoTrack.Dimensions} RSP payload.\n * @param {VideoTrack.Dimensions} [dimensions]\n * @returns {object}\n */\n\n\nfunction createDimensionsPayload(dimensions) {\n  return createRSPPayload(dimensions, [{\n    prop: 'height',\n    type: 'number'\n  }, {\n    prop: 'width',\n    type: 'number'\n  }]);\n}\n/**\n * Create {@link VideoRenderDimensions} RSP payload.\n * @param renderDimensions\n * @returns {object}\n */\n\n\nfunction createRenderDimensionsPayload(renderDimensions) {\n  var PRIORITY_HIGH = trackPriority.PRIORITY_HIGH,\n      PRIORITY_LOW = trackPriority.PRIORITY_LOW,\n      PRIORITY_STANDARD = trackPriority.PRIORITY_STANDARD;\n  return createRSPPayload(renderDimensions, [{\n    prop: PRIORITY_HIGH,\n    type: 'object',\n    transform: createDimensionsPayload\n  }, {\n    prop: PRIORITY_LOW,\n    type: 'object',\n    transform: createDimensionsPayload\n  }, {\n    prop: PRIORITY_STANDARD,\n    type: 'object',\n    transform: createDimensionsPayload\n  }]);\n}\n/**\n * Create an RSP payload for the given object.\n * @param {object} object - object for which RSP payload is to be generated\n * @param {Array<object>} propConversions - conversion rules for object properties;\n *   they specify how object properties should be converted to their corresponding\n *   RSP payload properties\n * @returns {object}\n */\n\n\nfunction createRSPPayload(object, propConversions) {\n  return propConversions.reduce(function (payload, _a) {\n    var _b;\n\n    var prop = _a.prop,\n        type = _a.type,\n        _c = _a.payloadProp,\n        payloadProp = _c === void 0 ? prop : _c,\n        _d = _a.transform,\n        transform = _d === void 0 ? function (x) {\n      return x;\n    } : _d;\n    return typeof object[prop] === type ? Object.assign((_b = {}, _b[payloadProp] = transform(object[prop]), _b), payload) : payload;\n  }, {});\n}\n/**\n * Create the subscribe payload included in an RSP connect/update message.\n * @param {boolean} automaticSubscription - whether to subscribe to all RemoteTracks\n * @returns {object}\n */\n\n\nfunction createSubscribePayload(automaticSubscription) {\n  return {\n    rules: [{\n      type: automaticSubscription ? 'include' : 'exclude',\n      all: true\n    }],\n    revision: 1\n  };\n}\n\nfunction createMediaWarningsPayload(notifyWarnings) {\n  var _a;\n\n  var mediaWarnings = (_a = {}, _a[TwilioWarning.recordingMediaLost] = 'recordings', _a);\n  return notifyWarnings.map(function (twilioWarningName) {\n    return mediaWarnings[twilioWarningName];\n  }).filter(function (name) {\n    return !!name;\n  });\n}\n/**\n * Add random jitter to a given value in the range [-jitter, jitter].\n * @private\n * @param {number} value\n * @param {number} jitter\n * @returns {number} value + random(-jitter, +jitter)\n */\n\n\nfunction withJitter(value, jitter) {\n  var rand = Math.random();\n  return value - jitter + Math.floor(2 * jitter * rand + 0.5);\n}\n/**\n * Checks if the a number is in the range [min, max].\n * @private\n * @param {num} num\n * @param {number} min\n * @param {number} max\n * @return {boolean}\n */\n\n\nfunction inRange(num, min, max) {\n  return min <= num && num <= max;\n}\n/**\n * returns true if given MediaStreamTrack is a screen share track\n * @private\n * @param {MediaStreamTrack} track\n * @returns {boolean}\n */\n\n\nfunction isChromeScreenShareTrack(track) {\n  // NOTE(mpatwardhan): Chrome creates screen share tracks with label like: \"screen:69734272*\"\n  // we will check for label that starts with \"screen:D\" where D being a digit.\n  return util.guessBrowser() === 'chrome' && track.kind === 'video' && 'displaySurface' in track.getSettings();\n}\n/**\n * returns true if given MediaStreamTrack is a user media track\n * @private\n * @param {MediaStreamTrack} track\n * @returns {boolean}\n */\n\n\nfunction isUserMediaTrack(track) {\n  // NOTE(mpatwardhan): tracks obtained from getUserMedia have a deviceId in its settings.\n  return typeof track.getSettings().deviceId === 'string';\n}\n/**\n * Returns a promise that resolve after timeoutMS have passed.\n * @param {number} timeoutMS - time to wait in milliseconds.\n * @returns {Promise<void>}\n */\n\n\nfunction waitForSometime(timeoutMS) {\n  if (timeoutMS === void 0) {\n    timeoutMS = 10;\n  }\n\n  return new Promise(function (resolve) {\n    return setTimeout(resolve, timeoutMS);\n  });\n}\n/**\n * Returns a promise that resolve after event is received\n * @returns {Promise<void>}\n */\n\n\nfunction waitForEvent(eventTarget, event) {\n  return new Promise(function (resolve) {\n    eventTarget.addEventListener(event, function onevent(e) {\n      eventTarget.removeEventListener(event, onevent);\n      resolve(e);\n    });\n  });\n}\n\nexports.constants = constants;\nexports.createBandwidthProfilePayload = createBandwidthProfilePayload;\nexports.createMediaSignalingPayload = createMediaSignalingPayload;\nexports.createMediaWarningsPayload = createMediaWarningsPayload;\nexports.createRoomConnectEventPayload = createRoomConnectEventPayload;\nexports.createSubscribePayload = createSubscribePayload;\nexports.asLocalTrack = asLocalTrack;\nexports.asLocalTrackPublication = asLocalTrackPublication;\nexports.capitalize = capitalize;\nexports.deprecateEvents = deprecateEvents;\nexports.difference = difference;\nexports.filterObject = filterObject;\nexports.flatMap = flatMap;\nexports.getPlatform = getPlatform;\nexports.getUserAgent = getUserAgent;\nexports.hidePrivateProperties = hidePrivateProperties;\nexports.hidePrivateAndCertainPublicPropertiesInClass = hidePrivateAndCertainPublicPropertiesInClass;\nexports.isDeepEqual = isDeepEqual;\nexports.isNonArrayObject = isNonArrayObject;\nexports.inRange = inRange;\nexports.makeUUID = makeUUID;\nexports.oncePerTick = oncePerTick;\nexports.promiseFromEvents = promiseFromEvents;\nexports.getOrNull = getOrNull;\nexports.defer = defer;\nexports.delegateMethods = delegateMethods;\nexports.proxyProperties = proxyProperties;\nexports.legacyPromise = legacyPromise;\nexports.buildLogLevels = buildLogLevels;\nexports.trackClass = trackClass;\nexports.trackPublicationClass = trackPublicationClass;\nexports.valueToJSON = valueToJSON;\nexports.withJitter = withJitter;\nexports.isChromeScreenShareTrack = isChromeScreenShareTrack;\nexports.isUserMediaTrack = isUserMediaTrack;\nexports.waitForSometime = waitForSometime;\nexports.waitForEvent = waitForEvent;","map":{"version":3,"mappings":"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","names":["constants","require","E","trackPriority","util","sessionSID","TwilioWarning","asLocalTrack","track","options","LocalAudioTrack","LocalVideoTrack","LocalDataTrack","MediaStreamTrack","kind","INVALID_TYPE","asLocalTrackPublication","signaling","unpublish","LocalTrackPublication","audio","LocalAudioTrackPublication","video","LocalVideoTrackPublication","data","LocalDataTrackPublication","capitalize","word","toUpperCase","slice","deprecateEvents","name","emitter","events","log","warningsShown","Set","on","newListener","event","has","deprecated","get","add","size","removeListener","difference","list1","list2","Array","isArray","values","forEach","item","filterObject","object","filterValue","Object","keys","reduce","filtered","key","flatMap","list","mapFn","listArray","Map","from","flattened","mapped","concat","getUserAgent","navigator","userAgent","getPlatform","match","_b","split","map","trim","platform","toLowerCase","makeUUID","replace","r","Math","random","v","c","toString","oncePerTick","fn","timeout","nextTick","scheduleNextTick","clearTimeout","setTimeout","promiseFromEvents","operation","eventEmitter","successEvent","failureEvent","Promise","resolve","reject","onSuccess","args","call","arguments","onFailure","__spreadArray","once","getOrNull","obj","path","output","step","defer","deferred","promise","delegateMethod","source","wrapper","target","methodName","type","error","apply","_a","delegateMethods","isDeepEqual","val1","val2","length","every","val","i","val1Keys","sort","val2Keys","isNonArrayObject","proxyProperties","getOwnPropertyNames","proxyProperty","propertyName","defineProperty","value","writable","addEventListener","dispatchEvent","enumerable","legacyPromise","then","result","buildLogLevels","logLevel","default","media","webrtc","trackClass","local","trackPublicationClass","publication","hidePrivateProperties","startsWith","hideProperty","hidePrivateAndCertainPublicPropertiesInClass","klass","props","__extends","_this","hidePublicProperties","descriptor","getOwnPropertyDescriptor","hasOwnProperty","arrayToJSON","array","valueToJSON","setToJSON","set","mapToJSON","entries","json","_c","assign","objectToJSON","createRoomConnectEventPayload","connectOptions","boolToString","payload","iceServers","audioTracks","tracks","filter","videoTracks","dataTracks","prop","eventProp","isNaN","Number","JSON","stringify","networkQualityConfiguration","networkQuality","remote","bandwidthProfile","videoBPOptions_1","bandwidthProfileOptions","group","level","createBandwidthProfilePayload","createRSPPayload","transform","createBandwidthProfileVideoPayload","bandwidthProfileVideo","payloadProp","createRenderDimensionsPayload","createMediaSignalingPayload","dominantSpeaker","trackSwitchOff","adaptiveSimulcast","renderHints","transports","active_speaker","network_quality","render_hints","publisher_hints","track_priority","track_switch_off","createDimensionsPayload","dimensions","renderDimensions","PRIORITY_LOW","PRIORITY_STANDARD","PRIORITY_HIGH","propConversions","_d","createSubscribePayload","automaticSubscription","rules","all","revision","createMediaWarningsPayload","notifyWarnings","mediaWarnings","recordingMediaLost","twilioWarningName","withJitter","jitter","rand","floor","inRange","num","min","max","isChromeScreenShareTrack","guessBrowser","getSettings","isUserMediaTrack","deviceId","waitForSometime","timeoutMS","waitForEvent","eventTarget","onevent","e","removeEventListener","exports"],"sources":["/home/samliu/repos/ieee/tp-robot/node_modules/twilio-video/lib/util/index.js"],"sourcesContent":["'use strict';\n\nconst constants = require('./constants');\nconst { typeErrors: E, trackPriority } = constants;\nconst util = require('../webrtc/util');\nconst { sessionSID } = require('./sid');\nconst TwilioWarning = require('./twiliowarning');\n\n/**\n * Return the given {@link LocalTrack} or a new {@link LocalTrack} for the\n * given MediaStreamTrack.\n * @param {LocalTrack|MediaStreamTrack} track\n * @param {object} options\n * @returns {LocalTrack}\n * @throws {TypeError}\n */\nfunction asLocalTrack(track, options) {\n  if (track instanceof options.LocalAudioTrack\n    || track instanceof options.LocalVideoTrack\n    || track instanceof options.LocalDataTrack) {\n    return track;\n  }\n  if (track instanceof options.MediaStreamTrack) {\n    return track.kind === 'audio'\n      ? new options.LocalAudioTrack(track, options)\n      : new options.LocalVideoTrack(track, options);\n  }\n  /* eslint new-cap:0 */\n  throw E.INVALID_TYPE('track', 'LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack');\n}\n\n/**\n * Create a new {@link LocalTrackPublication} for the given {@link LocalTrack}.\n * @param {LocalTrack} track\n * @param {LocalTrackPublicationSignaling} signaling\n * @param {function(track: LocalTrackPublication): void} unpublish\n * @param {object} options\n */\nfunction asLocalTrackPublication(track, signaling, unpublish, options) {\n  const LocalTrackPublication = {\n    audio: options.LocalAudioTrackPublication,\n    video: options.LocalVideoTrackPublication,\n    data: options.LocalDataTrackPublication\n  }[track.kind];\n  return new LocalTrackPublication(signaling, track, unpublish, options);\n}\n\n/**\n * Capitalize a word.\n * @param {string} word\n * @returns {string} capitalized\n */\nfunction capitalize(word) {\n  return word[0].toUpperCase() + word.slice(1);\n}\n\n/**\n * Log deprecation warnings for the given events of an EventEmitter.\n * @param {string} name\n * @param {EventEmitter} emitter\n * @param {Map<string, string>} events\n * @param {Log} log\n */\nfunction deprecateEvents(name, emitter, events, log) {\n  const warningsShown = new Set();\n  emitter.on('newListener', function newListener(event) {\n    if (events.has(event) && !warningsShown.has(event)) {\n      log.deprecated(`${name}#${event} has been deprecated and scheduled for removal in twilio-video.js@2.0.0.${events.get(event)\n        ? ` Use ${name}#${events.get(event)} instead.`\n        : ''}`);\n      warningsShown.add(event);\n    }\n    if (warningsShown.size >= events.size) {\n      emitter.removeListener('newListener', newListener);\n    }\n  });\n}\n\n/**\n * Finds the items in list1 that are not in list2.\n * @param {Array<*>|Map<*>|Set<*>} list1\n * @param {Array<*>|Map<*>|Set<*>} list2\n * @returns {Set}\n */\nfunction difference(list1, list2) {\n  list1 = Array.isArray(list1) ? new Set(list1) : new Set(list1.values());\n  list2 = Array.isArray(list2) ? new Set(list2) : new Set(list2.values());\n\n  const difference = new Set();\n\n  list1.forEach(item => {\n    if (!list2.has(item)) {\n      difference.add(item);\n    }\n  });\n\n  return difference;\n}\n\n/**\n * Filter out the keys in an object with a given value.\n * @param {object} object - Object to be filtered\n * @param {*} [filterValue] - Value to be filtered out; If not specified, then\n *   filters out all keys which have an explicit value of \"undefined\"\n * @returns {object} - Filtered object\n */\nfunction filterObject(object, filterValue) {\n  return Object.keys(object).reduce((filtered, key) => {\n    if (object[key] !== filterValue) {\n      filtered[key] = object[key];\n    }\n    return filtered;\n  }, {});\n}\n\n/**\n * Map a list to an array of arrays, and return the flattened result.\n * @param {Array<*>|Set<*>|Map<*>} list\n * @param {function(*): Array<*>} [mapFn]\n * @returns Array<*>\n */\nfunction flatMap(list, mapFn) {\n  const listArray = list instanceof Map || list instanceof Set\n    ? Array.from(list.values())\n    : list;\n\n  mapFn = mapFn || function mapFn(item) {\n    return item;\n  };\n\n  return listArray.reduce((flattened, item) => {\n    const mapped = mapFn(item);\n    return flattened.concat(mapped);\n  }, []);\n}\n\n/**\n * Get the user agent string, or return \"Unknown\".\n * @returns {string}\n */\nfunction getUserAgent() {\n  return typeof navigator !== 'undefined' && navigator.userAgent\n    ? navigator.userAgent\n    : 'Unknown';\n}\n\n/**\n * Get the platform component of the user agent string.\n * Example:\n *   Input - Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.82 Safari/537.36\n *   Output - macintosh\n * @returns {string}\n */\nfunction getPlatform() {\n  const userAgent = getUserAgent();\n  const [, match = 'unknown'] = userAgent.match(/\\(([^)]+)\\)/) || [];\n  const [platform] = match.split(';').map(entry => entry.trim());\n  return platform.toLowerCase();\n}\n\n/**\n * Create a unique identifier.\n * @returns {string}\n */\nfunction makeUUID() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\n    const r = Math.random() * 16 | 0;\n    const v = c === 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n/**\n * Ensure that the given function is called once per tick.\n * @param {function} fn - Function to be executed\n * @returns {function} - Schedules the given function to be called on the next tick\n */\nfunction oncePerTick(fn) {\n  let timeout = null;\n\n  function nextTick() {\n    timeout = null;\n    fn();\n  }\n\n  return function scheduleNextTick() {\n    if (timeout) {\n      clearTimeout(timeout);\n    }\n    timeout = setTimeout(nextTick);\n  };\n}\n\nfunction promiseFromEvents(operation, eventEmitter, successEvent, failureEvent) {\n  return new Promise((resolve, reject) => {\n    function onSuccess() {\n      const args = [].slice.call(arguments);\n      if (failureEvent) {\n        eventEmitter.removeListener(failureEvent, onFailure);\n      }\n      resolve(...args);\n    }\n    function onFailure() {\n      const args = [].slice.call(arguments);\n      eventEmitter.removeListener(successEvent, onSuccess);\n      reject(...args);\n    }\n    eventEmitter.once(successEvent, onSuccess);\n    if (failureEvent) {\n      eventEmitter.once(failureEvent, onFailure);\n    }\n    operation();\n  });\n}\n\n/**\n * Traverse down multiple nodes on an object and return null if\n * any link in the path is unavailable.\n * @param {Object} obj - Object to traverse\n * @param {String} path - Path to traverse. Period-separated.\n * @returns {Any|null}\n */\nfunction getOrNull(obj, path) {\n  return path.split('.').reduce((output, step) => {\n    if (!output) { return null; }\n    return output[step];\n  }, obj);\n}\n\n/**\n * @typedef {object} Deferred\n * @property {Promise} promise\n * @property {function} reject\n * @property {function} resolve\n */\n\n/**\n * Create a {@link Deferred}.\n * @returns {Deferred}\n */\nfunction defer() {\n  const deferred = {};\n  deferred.promise = new Promise((resolve, reject) => {\n    deferred.resolve = resolve;\n    deferred.reject = reject;\n  });\n  return deferred;\n}\n\n/**\n * Copy a method from a `source` prototype onto a `wrapper` prototype. Invoking\n * the method on the `wrapper` prototype will invoke the corresponding method\n * on an instance accessed by `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @param {string} methodName\n * @returns {undefined}\n */\nfunction delegateMethod(source, wrapper, target, methodName) {\n  if (methodName in wrapper) {\n    // Skip any methods already set.\n    return;\n  } else if (methodName.match(/^on[a-z]+$/)) {\n    // Skip EventHandlers (these are handled in the constructor).\n    return;\n  }\n\n  let type;\n  try {\n    type = typeof source[methodName];\n  } catch (error) {\n    // NOTE(mroberts): Attempting to check the type of non-function members\n    // on the prototype throws an error for some types.\n  }\n\n  if (type !== 'function') {\n    // Skip non-function members.\n    return;\n  }\n\n  /* eslint no-loop-func:0 */\n  wrapper[methodName] = function(...args) {\n    return this[target][methodName](...args);\n  };\n}\n\n/**\n * Copy methods from a `source` prototype onto a `wrapper` prototype. Invoking\n * the methods on the `wrapper` prototype will invoke the corresponding method\n * on an instance accessed by `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @returns {undefined}\n */\nfunction delegateMethods(source, wrapper, target) {\n  for (const methodName in source) {\n    delegateMethod(source, wrapper, target, methodName);\n  }\n}\n\n/**\n * Determine whether two values are deeply equal.\n * @param {*} val1\n * @param {*} val2\n * @returns {boolean}\n */\nfunction isDeepEqual(val1, val2) {\n  if (val1 === val2) {\n    return true;\n  }\n  if (typeof val1 !== typeof val2) {\n    return false;\n  }\n  if (val1 === null) {\n    return val2 === null;\n  }\n  if (val2 === null) {\n    return false;\n  }\n  if (Array.isArray(val1)) {\n    return Array.isArray(val2)\n      && val1.length === val2.length\n      && val1.every((val, i) => isDeepEqual(val, val2[i]));\n  }\n  if (typeof val1 === 'object') {\n    const val1Keys = Object.keys(val1).sort();\n    const val2Keys = Object.keys(val2).sort();\n    return !Array.isArray(val2)\n      && isDeepEqual(val1Keys, val2Keys)\n      && val1Keys.every(key => isDeepEqual(val1[key], val2[key]));\n  }\n  return false;\n}\n\n/**\n * Whether the given argument is a non-array object.\n * @param {*} object\n * @return {boolean}\n */\nfunction isNonArrayObject(object) {\n  return typeof object === 'object' && !Array.isArray(object);\n}\n\n/**\n * For each property name on the `source` prototype, add getters and/or setters\n * to `wrapper` that proxy to `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @returns {undefined}\n */\nfunction proxyProperties(source, wrapper, target) {\n  Object.getOwnPropertyNames(source).forEach(propertyName => {\n    proxyProperty(source, wrapper, target, propertyName);\n  });\n}\n\n/**\n * For the property name on the `source` prototype, add a getter and/or setter\n * to `wrapper` that proxies to `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @param {string} propertyName\n * @returns {undefined}\n */\nfunction proxyProperty(source, wrapper, target, propertyName) {\n  if (propertyName in wrapper) {\n    // Skip any properties already set.\n    return;\n  } else if (propertyName.match(/^on[a-z]+$/)) {\n    Object.defineProperty(wrapper, propertyName, {\n      value: null,\n      writable: true\n    });\n\n    target.addEventListener(propertyName.slice(2), function(...args) {\n      wrapper.dispatchEvent(...args);\n    });\n\n    return;\n  }\n\n  Object.defineProperty(wrapper, propertyName, {\n    enumerable: true,\n    get() {\n      return target[propertyName];\n    }\n  });\n}\n\n/**\n * This is a function for turning a Promise into the kind referenced in the\n * Legacy Interface Extensions section of the WebRTC spec.\n * @param {Promise<*>} promise\n * @param {function<*>} onSuccess\n * @param {function<Error>} onFailure\n * @returns {Promise<undefined>}\n */\nfunction legacyPromise(promise, onSuccess, onFailure) {\n  if (onSuccess) {\n    return promise.then(result => {\n      onSuccess(result);\n    }, error => {\n      onFailure(error);\n    });\n  }\n  return promise;\n}\n\n/**\n * Build the {@link LogLevels} object.\n * @param {String|LogLevel} logLevel - Log level name or object\n * @returns {LogLevels}\n */\nfunction buildLogLevels(logLevel) {\n  if (typeof logLevel === 'string') {\n    return {\n      default: logLevel,\n      media: logLevel,\n      signaling: logLevel,\n      webrtc: logLevel\n    };\n  }\n  return logLevel;\n}\n\n/**\n * Get the {@link Track}'s derived class name\n * @param {Track} track\n * @param {?boolean} [local=undefined]\n * @returns {string}\n */\nfunction trackClass(track, local) {\n  local = local ? 'Local' : '';\n  return `${local + (track.kind || '').replace(/\\w{1}/, m => m.toUpperCase())}Track`;\n}\n\n/**\n * Get the {@link TrackPublication}'s derived class name\n * @param {TrackPublication} publication\n * @param {?boolean} [local=undefined]\n * @returns {string}\n */\nfunction trackPublicationClass(publication, local) {\n  local = local ? 'Local' : '';\n  return `${local + (publication.kind || '').replace(/\\w{1}/, m => m.toUpperCase())}TrackPublication`;\n}\n\n/**\n * Sets all underscore-prefixed properties on `object` non-enumerable.\n * @param {Object} object\n * @returns {void}\n */\nfunction hidePrivateProperties(object) {\n  Object.getOwnPropertyNames(object).forEach(name => {\n    if (name.startsWith('_')) {\n      hideProperty(object, name);\n    }\n  });\n}\n\n/**\n * Creates a new subclass which, in the constructor, sets all underscore-prefixed\n * properties and the given public properties non-enumerable. This is useful for\n * patching up classes like EventEmitter which may set properties like `_events`\n * and `domain`.\n * @param {Function} klass\n * @param {Array<string>} props\n * @returns {Function} subclass\n */\nfunction hidePrivateAndCertainPublicPropertiesInClass(klass, props) {\n  // NOTE(mroberts): We do this to avoid giving the class a name.\n  return class extends klass {\n    constructor(...args) {\n      super(...args);\n      hidePrivateProperties(this);\n      hidePublicProperties(this, props);\n    }\n  };\n}\n\n/**\n * Hide a property of an object.\n * @param {object} object\n * @param {string} name\n */\nfunction hideProperty(object, name) {\n  const descriptor = Object.getOwnPropertyDescriptor(object, name);\n  descriptor.enumerable = false;\n  Object.defineProperty(object, name, descriptor);\n}\n\n/**\n * Hide the given public properties of an object.\n * @param {object} object\n * @param {Array<string>} [props=[]]\n */\nfunction hidePublicProperties(object, props = []) {\n  props.forEach(name => {\n    // eslint-disable-next-line no-prototype-builtins\n    if (object.hasOwnProperty(name)) {\n      hideProperty(object, name);\n    }\n  });\n}\n\n/**\n * Convert an Array of values to an Array of JSON values by calling\n * `valueToJSON` on each value.\n * @param {Array<*>} array\n * @returns {Array<*>}\n */\nfunction arrayToJSON(array) {\n  return array.map(valueToJSON);\n}\n\n/**\n * Convert a Set of values to an Array of JSON values by calling `valueToJSON`\n * on each value.\n * @param {Set<*>} set\n * @returns {Array<*>}\n */\nfunction setToJSON(set) {\n  return arrayToJSON([...set]);\n}\n\n/**\n * Convert a Map from strings to values to an object of JSON values by calling\n * `valueToJSON` on each value.\n * @param {Map<string, *>} map\n * @returns {object}\n */\nfunction mapToJSON(map) {\n  return [...map.entries()].reduce((json, [key, value]) => {\n    return Object.assign({ [key]: valueToJSON(value) }, json);\n  }, {});\n}\n\n/**\n * Convert an object to a JSON value by calling `valueToJSON` on its enumerable\n * keys.\n * @param {object} object\n * @returns {object}\n */\nfunction objectToJSON(object) {\n  return Object.entries(object).reduce((json, [key, value]) => {\n    return Object.assign({ [key]: valueToJSON(value) }, json);\n  }, {});\n}\n\n/**\n * Convert a value into a JSON value.\n * @param {*} value\n * @returns {*}\n */\nfunction valueToJSON(value) {\n  if (Array.isArray(value)) {\n    return arrayToJSON(value);\n  } else if (value instanceof Set) {\n    return setToJSON(value);\n  } else if (value instanceof Map) {\n    return mapToJSON(value);\n  } else if (value && typeof value === 'object') {\n    return objectToJSON(value);\n  }\n  return value;\n}\n\nfunction createRoomConnectEventPayload(connectOptions) {\n  function boolToString(val) {\n    return val ? 'true' : 'false';\n  }\n  const payload = {\n    sessionSID,\n\n    // arrays props converted to lengths.\n    iceServers: (connectOptions.iceServers || []).length,\n    audioTracks: (connectOptions.tracks || []).filter(track => track.kind === 'audio').length,\n    videoTracks: (connectOptions.tracks || []).filter(track => track.kind === 'video').length,\n    dataTracks: (connectOptions.tracks || []).filter(track => track.kind === 'data').length,\n  };\n\n  // boolean properties.\n  [['audio'], ['automaticSubscription'], ['enableDscp'], ['eventListener'], ['preflight'], ['video'], ['dominantSpeaker', 'enableDominantSpeaker']].forEach(([prop, eventProp]) => {\n    eventProp = eventProp || prop;\n    payload[eventProp] = boolToString(!!connectOptions[prop]);\n  });\n\n  // numbers properties.\n  [['maxVideoBitrate'], ['maxAudioBitrate']].forEach(([prop, eventProp]) => {\n    eventProp = eventProp || prop;\n    if (typeof connectOptions[prop] === 'number') {\n      payload[eventProp] = connectOptions[prop];\n    } else if (!isNaN(Number(connectOptions[prop]))) {\n      payload[eventProp] = Number(connectOptions[prop]);\n    }\n  });\n\n  // string properties.\n  [['iceTransportPolicy'], ['region'], ['name', 'roomName']].forEach(([prop, eventProp]) => {\n    eventProp = eventProp || prop;\n    if (typeof connectOptions[prop] === 'string') {\n      payload[eventProp] = connectOptions[prop];\n    } else if (typeof connectOptions[prop] === 'number' && prop === 'name') {\n      payload[eventProp] = connectOptions[prop].toString();\n    }\n  });\n\n  // array props stringified.\n  ['preferredAudioCodecs', 'preferredVideoCodecs'].forEach(prop => {\n    if (prop in connectOptions) {\n      payload[prop] = JSON.stringify(connectOptions[prop]);\n    }\n  });\n\n  if ('networkQuality' in connectOptions) {\n    payload.networkQualityConfiguration = {};\n    if (isNonArrayObject(connectOptions.networkQuality)) {\n      ['local', 'remote'].forEach(prop => {\n        if (typeof connectOptions.networkQuality[prop] === 'number') {\n          payload.networkQualityConfiguration[prop] = connectOptions.networkQuality[prop];\n        }\n      });\n    } else {\n      payload.networkQualityConfiguration.remote = 0;\n      payload.networkQualityConfiguration.local = connectOptions.networkQuality ? 1 : 0;\n    }\n  }\n\n  if (connectOptions.bandwidthProfile && connectOptions.bandwidthProfile.video) {\n    const videoBPOptions = connectOptions.bandwidthProfile.video || {};\n    payload.bandwidthProfileOptions = {};\n    ['mode', 'maxTracks', 'trackSwitchOffMode', 'dominantSpeakerPriority', 'maxSubscriptionBitrate', 'renderDimensions', 'contentPreferencesMode', 'clientTrackSwitchOffControl'].forEach(prop => {\n      if (typeof videoBPOptions[prop] === 'number' || typeof videoBPOptions[prop] === 'string') {\n        payload.bandwidthProfileOptions[prop] = videoBPOptions[prop];\n      } else if (typeof videoBPOptions[prop] === 'boolean') {\n        payload.bandwidthProfileOptions[prop] = boolToString(videoBPOptions[prop]);\n      } else if (typeof videoBPOptions[prop] === 'object') {\n        payload.bandwidthProfileOptions[prop] = JSON.stringify(videoBPOptions[prop]);\n      }\n    });\n  }\n\n  return {\n    group: 'room',\n    name: 'connect',\n    level: 'info',\n    payload\n  };\n}\n\n/**\n * Create the bandwidth profile payload included in an RSP connect message.\n * @param {BandwidthProfileOptions} bandwidthProfile\n * @returns {object}\n */\nfunction createBandwidthProfilePayload(bandwidthProfile) {\n  return createRSPPayload(bandwidthProfile, [\n    { prop: 'video', type: 'object', transform: createBandwidthProfileVideoPayload }\n  ]);\n}\n\n/**\n * Create the bandwidth profile video payload included in an RSP connect message.\n * @param {VideoBandwidthProfileOptions} bandwidthProfileVideo\n * @returns {object}\n */\nfunction createBandwidthProfileVideoPayload(bandwidthProfileVideo) {\n  return createRSPPayload(bandwidthProfileVideo, [\n    { prop: 'dominantSpeakerPriority', type: 'string', payloadProp: 'active_speaker_priority' },\n    { prop: 'maxSubscriptionBitrate', type: 'number', payloadProp: 'max_subscription_bandwidth' },\n    { prop: 'maxTracks', type: 'number', payloadProp: 'max_tracks' },\n    { prop: 'mode', type: 'string' },\n    { prop: 'renderDimensions', type: 'object', payloadProp: 'render_dimensions', transform: createRenderDimensionsPayload },\n    { prop: 'trackSwitchOffMode', type: 'string', payloadProp: 'track_switch_off' }\n  ]);\n}\n\n/**\n * Create the Media Signaling payload included in an RSP connect message.\n * @param {boolean} dominantSpeaker - whether to enable the Dominant Speaker\n *   protocol or not\n * @param {boolean} networkQuality - whether to enable the Network Quality\n *   protocol or not\n * @param {boolean} trackPriority - whether to enable the Track Priority\n *   protocol or not\n * @param {boolean} trackSwitchOff - whether to enable the Track Switch-Off\n *   protocol or not.\n * @param {boolean} renderHints - whether to enable the renderHints\n *   protocol or not.\n * @returns {object}\n */\nfunction createMediaSignalingPayload(dominantSpeaker, networkQuality, trackPriority, trackSwitchOff, adaptiveSimulcast, renderHints) {\n  const transports = { transports: [{ type: 'data-channel' }] };\n  return Object.assign(\n    dominantSpeaker\n      // eslint-disable-next-line\n      ? { active_speaker: transports }\n      : {},\n    networkQuality\n      // eslint-disable-next-line\n      ? { network_quality: transports }\n      : {},\n    renderHints\n      // eslint-disable-next-line\n      ? { render_hints: transports }\n      : {},\n    adaptiveSimulcast\n      // eslint-disable-next-line\n      ? { publisher_hints: transports }\n      : {},\n    trackPriority\n      // eslint-disable-next-line\n      ? { track_priority: transports }\n      : {},\n    trackSwitchOff\n      // eslint-disable-next-line\n      ? { track_switch_off: transports }\n      : {}\n  );\n}\n\n/**\n * Create {@link VideoTrack.Dimensions} RSP payload.\n * @param {VideoTrack.Dimensions} [dimensions]\n * @returns {object}\n */\nfunction createDimensionsPayload(dimensions) {\n  return createRSPPayload(dimensions, [\n    { prop: 'height', type: 'number' },\n    { prop: 'width', type: 'number' }\n  ]);\n}\n\n/**\n * Create {@link VideoRenderDimensions} RSP payload.\n * @param renderDimensions\n * @returns {object}\n */\nfunction createRenderDimensionsPayload(renderDimensions) {\n  const { PRIORITY_HIGH, PRIORITY_LOW, PRIORITY_STANDARD } = trackPriority;\n  return createRSPPayload(renderDimensions, [\n    { prop: PRIORITY_HIGH, type: 'object', transform: createDimensionsPayload },\n    { prop: PRIORITY_LOW, type: 'object', transform: createDimensionsPayload },\n    { prop: PRIORITY_STANDARD, type: 'object', transform: createDimensionsPayload }\n  ]);\n}\n\n/**\n * Create an RSP payload for the given object.\n * @param {object} object - object for which RSP payload is to be generated\n * @param {Array<object>} propConversions - conversion rules for object properties;\n *   they specify how object properties should be converted to their corresponding\n *   RSP payload properties\n * @returns {object}\n */\nfunction createRSPPayload(object, propConversions) {\n  return propConversions.reduce((payload, { prop, type, payloadProp = prop, transform = x => x }) => {\n    return typeof object[prop] === type\n      ? Object.assign({ [payloadProp]: transform(object[prop]) }, payload)\n      : payload;\n  }, {});\n}\n\n/**\n * Create the subscribe payload included in an RSP connect/update message.\n * @param {boolean} automaticSubscription - whether to subscribe to all RemoteTracks\n * @returns {object}\n */\nfunction createSubscribePayload(automaticSubscription) {\n  return {\n    rules: [{\n      type: automaticSubscription ? 'include' : 'exclude',\n      all: true\n    }],\n    revision: 1\n  };\n}\n\nfunction createMediaWarningsPayload(notifyWarnings) {\n  const mediaWarnings = {\n    [TwilioWarning.recordingMediaLost]: 'recordings'\n  };\n  return notifyWarnings\n    .map(twilioWarningName => mediaWarnings[twilioWarningName])\n    .filter(name => !!name);\n}\n\n/**\n * Add random jitter to a given value in the range [-jitter, jitter].\n * @private\n * @param {number} value\n * @param {number} jitter\n * @returns {number} value + random(-jitter, +jitter)\n */\nfunction withJitter(value, jitter) {\n  const rand = Math.random();\n  return value - jitter + Math.floor(2 * jitter * rand + 0.5);\n}\n\n/**\n * Checks if the a number is in the range [min, max].\n * @private\n * @param {num} num\n * @param {number} min\n * @param {number} max\n * @return {boolean}\n */\nfunction inRange(num, min, max) {\n  return min <= num && num <= max;\n}\n\n/**\n * returns true if given MediaStreamTrack is a screen share track\n * @private\n * @param {MediaStreamTrack} track\n * @returns {boolean}\n */\nfunction isChromeScreenShareTrack(track) {\n  // NOTE(mpatwardhan): Chrome creates screen share tracks with label like: \"screen:69734272*\"\n  // we will check for label that starts with \"screen:D\" where D being a digit.\n  return util.guessBrowser() === 'chrome' && track.kind === 'video' && 'displaySurface' in track.getSettings();\n}\n\n\n/**\n * returns true if given MediaStreamTrack is a user media track\n * @private\n * @param {MediaStreamTrack} track\n * @returns {boolean}\n */\nfunction isUserMediaTrack(track) {\n  // NOTE(mpatwardhan): tracks obtained from getUserMedia have a deviceId in its settings.\n  return typeof track.getSettings().deviceId === 'string';\n}\n\n/**\n * Returns a promise that resolve after timeoutMS have passed.\n * @param {number} timeoutMS - time to wait in milliseconds.\n * @returns {Promise<void>}\n */\nfunction waitForSometime(timeoutMS = 10) {\n  return new Promise(resolve => setTimeout(resolve, timeoutMS));\n}\n\n/**\n * Returns a promise that resolve after event is received\n * @returns {Promise<void>}\n */\nfunction waitForEvent(eventTarget, event) {\n  return new Promise(resolve => {\n    eventTarget.addEventListener(event, function onevent(e) {\n      eventTarget.removeEventListener(event, onevent);\n      resolve(e);\n    });\n  });\n}\n\nexports.constants = constants;\nexports.createBandwidthProfilePayload = createBandwidthProfilePayload;\nexports.createMediaSignalingPayload = createMediaSignalingPayload;\nexports.createMediaWarningsPayload = createMediaWarningsPayload;\nexports.createRoomConnectEventPayload = createRoomConnectEventPayload;\nexports.createSubscribePayload = createSubscribePayload;\nexports.asLocalTrack = asLocalTrack;\nexports.asLocalTrackPublication = asLocalTrackPublication;\nexports.capitalize = capitalize;\nexports.deprecateEvents = deprecateEvents;\nexports.difference = difference;\nexports.filterObject = filterObject;\nexports.flatMap = flatMap;\nexports.getPlatform = getPlatform;\nexports.getUserAgent = getUserAgent;\nexports.hidePrivateProperties = hidePrivateProperties;\nexports.hidePrivateAndCertainPublicPropertiesInClass = hidePrivateAndCertainPublicPropertiesInClass;\nexports.isDeepEqual = isDeepEqual;\nexports.isNonArrayObject = isNonArrayObject;\nexports.inRange = inRange;\nexports.makeUUID = makeUUID;\nexports.oncePerTick = oncePerTick;\nexports.promiseFromEvents = promiseFromEvents;\nexports.getOrNull = getOrNull;\nexports.defer = defer;\nexports.delegateMethods = delegateMethods;\nexports.proxyProperties = proxyProperties;\nexports.legacyPromise = legacyPromise;\nexports.buildLogLevels = buildLogLevels;\nexports.trackClass = trackClass;\nexports.trackPublicationClass = trackPublicationClass;\nexports.valueToJSON = valueToJSON;\nexports.withJitter = withJitter;\nexports.isChromeScreenShareTrack = isChromeScreenShareTrack;\nexports.isUserMediaTrack = isUserMediaTrack;\nexports.waitForSometime = waitForSometime;\nexports.waitForEvent = waitForEvent;\n"]},"metadata":{},"sourceType":"script"}